type: procfile

description: Deploy Config to be used for deploying Orion branches including staging. We use 'Orion' for deploying master

includeConfigs:
- Orion-common

appRoot: /orion-deploy/v3-staging

trafficSplittingEnabled: false

loadBalancers:
- bootstrap
- build
- privatehubteam

artifactBuildMetadata:
  repository: Orion
  module: OrionService
  branch: qa-deploys

servers:
  qa:
  - kubernetes:
      instances: 2
  prod:
  - kubernetes:
      instances: 5

env:
  all:
    JAR_NAME: ./target/OrionService-executable.jar
    JVM_MAX_HEAP: 2048m
    HS_ACCESS_GROUP: hs-paas-deploy
    VAULT_ACCESS_GROUP: hs-paas-deploy
  qa:
    EXTRA_JVM_ARGS: -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=0

vaultAccessGroup: hs-paas-deploy

zkGroup: mesos:deploy:hs_staging:v3

procfile:
  web:
    cmd: java-wrapper $EXTRA_JVM_ARGS -Djute.maxbuffer=3145728 -Djava.net.preferIPv4Stack=true -jar $JAR_NAME server $CONFIG_YAML
    type: SERVICE
    resources:
      numCpus: 8
logging:
  level: DEBUG
  loggers:
    com.hubspot.orion.poller: DEBUG

http:
  maxIdleTime: 200s

postDeployTests:
  all:
    mesos:
    - OrionAcceptanceTests
    - ORIONBOT_AcceptanceTests
healthcheckStartupTimeout: 380s
