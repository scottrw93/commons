type: load_balancer

appRoot: /orion/v3-staging

hublets:
  - NA1

team: hs-paas-deploy

slack:
- channelName: "#paas-build-deploy-notifications"
  all:
    preDeploy: MUTE
    success: NOTIFY
    failure: NOTIFY
    notifyForBlockerEvents: NOTIFY
    deployedNotRun: MUTE
  qa:
    success: MUTE
    failure: MUTE
    notifyForBlockerEvents: MUTE

loadBalancers:
- privatehubteam
- bootstrap
- build

nginx:
  proxyConfig: |
    location  /orion/v3-staging {
      set $orionbranchhost 'service-mainline.app-orion-branch-web.svc.iad02.k8s.run:8080';
      if ($hs_env = "qa") { set $orionbranchhost 'service-mainline.app-orion-branch-web.svc.iad03.k8s.run:8080'; }
      proxy_pass_header Server;
      proxy_set_header Host $http_host;
      proxy_set_header X-HubSpot-Trace $x_hubspot_trace;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Scheme $scheme;
      proxy_set_header X-Request-Start "${msec}";
      set $hs_service_name "orion-branch-web";
      proxy_connect_timeout 55;
      proxy_read_timeout 60;
      proxy_pass http://$orionbranchhost;
    }
    location ~ ^/orion/v3-staging/deployrequests(.*)$ {
      set $orionbranchrequestshost 'service-mainline.app-orion-requestservice-branch-web.svc.iad02.k8s.run:8080';
      if ($hs_env = "qa") { set $orionbranchrequestshost 'service-mainline.app-orion-requestservice-branch-web.svc.iad03.k8s.run:8080'; }
      proxy_pass_header Server;
      proxy_set_header Host $http_host;
      proxy_set_header X-HubSpot-Trace $x_hubspot_trace;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Scheme $scheme;
      proxy_set_header X-Request-Start "${msec}";
      set $hs_service_name "orion-branch-web";
      proxy_connect_timeout 55;
      proxy_read_timeout 60;
      proxy_pass http://$orionbranchrequestshost/orion/v4-staging/deployer/deployrequests$1;
    }
