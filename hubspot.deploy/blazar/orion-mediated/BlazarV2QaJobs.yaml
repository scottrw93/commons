type: procfile
artifactBuildMetadata:
  organization: HubSpotProtected
  repository: Blazar
  module: BlazarJobs

includeConfigs:
- BlazarV2QaSettings

env:
  all:
    JAR_NAME: target/BlazarJobs-executable.jar

procfile:
  # Cleans archived repos
  cleanMetadataCommand:
    type: SCHEDULED_JOB
    cmd: java-wrapper $EXTRA_ARGS -jar $JAR_NAME clean_repo_metadata
    schedule: "0 2 * * *"
    override:
      qa:
        allowSpotInstances: true
  # Deletes old queue items
  eventQueueCleanCommand:
    type: SCHEDULED_JOB
    cmd: java-wrapper $EXTRA_ARGS -jar $JAR_NAME event_queue_clean
    schedule: "8 * * * *"
    override:
      qa:
        allowSpotInstances: true

  # Cleans up old branch metadata
  inactiveBranchMetadataCleanCommand:
    type: ON_DEMAND
    cmd: java-wrapper $EXTRA_ARGS -jar $JAR_NAME inactive_branch_metadata_clean

  backfillRepositoryBuildRequests:
    type: ON_DEMAND
    cmd: java-wrapper $EXTRA_ARGS -jar $JAR_NAME backfill_repo_build 
    
  backfillInterprojectBuildRequests:
    type: ON_DEMAND
    cmd: java-wrapper $EXTRA_ARGS -jar $JAR_NAME backfill_inter_project_build
    
  # Rediscovers modules in branches containing a multi module
  rediscoverMultiModuleRepos:
    type: ON_DEMAND
    cmd: java-wrapper $EXTRA_ARGS -jar $JAR_NAME rediscover_multi_module

servers:
  qa:
  - mesos
  prod: []
