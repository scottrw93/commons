type: procfile

description: Deploy Config to be used for deploying Orion branches including staging. We use 'Orion' for deploying master

includeConfigs:
- Orion-common

appRoot: /orion-mesos-deploy/v3-staging

trafficSplittingEnabled: false

loadBalancers:
- bootstrap
- build
- privatehubteam

artifactBuildMetadata:
  repository: Orion
  module: OrionDeployWorker
  branch: qa-deploys

buildResolution:
  prod: NO_BUILD

hublets:
  - NA1

servers:
  qa:
  - kubernetes:
      # TODO Lower instances when we are more confident in proxy deploys
      instances: 5
  prod:
  - kubernetes:
      instances: 4

env:
  all:
    JAR_NAME: ./target/OrionDeployWorker-executable.jar
    JVM_MAX_HEAP: 4096m
    HS_ACCESS_GROUP: hs-paas-deploy
    VAULT_ACCESS_GROUP: hs-paas-deploy
  qa:
    EXTRA_JVM_ARGS: -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=9999 -XX:ActiveProcessorCount=12
    FAILURE_INJECTION_AGENT: "true"

vaultAccessGroup: hs-paas-deploy

zkGroup: mesos:deploy:hs_staging:v3

procfile:
  web:
    cmd: java-wrapper $EXTRA_JVM_ARGS -Djute.maxbuffer=10485760 -Djava.net.preferIPv4Stack=true -jar $JAR_NAME server $CONFIG_YAML
    type: SERVICE
    resources:
      numCpus: 4
logging:
  level: DEBUG
  loggers:
    com.hubspot.orion.poller: DEBUG

http:
  maxIdleTime: 200s

postDeployTests:
  all:
    mesos:
    - OrionAcceptanceTests
    - ORIONBOT_AcceptanceTests
    - ScheduledProdDeployTests
    - ScheduledProdRevertTests
  prod:
    mesos:
      - LargeDeployableTreeDeployTest
healthcheckStartupTimeout: 380s
