team: hs-paas-build-deploy
type: load_balancer
appRoot: /vault

description: Proxies requests from build.hubteam(qa).com/vault/ to vault

loadBalancers:
 - build

owners:
 - paas@hubspot.com

servers:
  qa: []
  prod: []

nginx:
  proxyConfig: |
    set $vaultUri https://vault.iad02.hubinfra.com:443/;
    if ($hs_env = "qa") {
        set $vaultUri https://vault.iad03.hubinfraqa.com:443/;
    }

    location /vault {
      rewrite ^/vault/(/.*)$ /v1/$1 break;
      proxy_pass_header Server;
      proxy_set_header Host $http_host;
      proxy_redirect off;
      proxy_set_header X-HubSpot-Trace $x_hubspot_trace;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Scheme $scheme;
      proxy_pass $vaultUri;
      proxy_connect_timeout 55;
      proxy_read_timeout 60;
      keepalive_timeout 0;
    }
